<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>fsck on 9Bon&#39;s_Docs</title>
        <link>https://docs.9bon.org/tags/fsck/</link>
        <description>Recent content in fsck on 9Bon&#39;s_Docs</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>ko-kr</language>
        <lastBuildDate>Sat, 12 Mar 2022 03:43:58 +0900</lastBuildDate><atom:link href="https://docs.9bon.org/tags/fsck/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>리눅스 디스크 문제</title>
        <link>https://docs.9bon.org/p/%EB%A6%AC%EB%88%85%EC%8A%A4-%EB%94%94%EC%8A%A4%ED%81%AC-%EB%AC%B8%EC%A0%9C/</link>
        <pubDate>Sat, 12 Mar 2022 03:43:58 +0900</pubDate>
        
        <guid>https://docs.9bon.org/p/%EB%A6%AC%EB%88%85%EC%8A%A4-%EB%94%94%EC%8A%A4%ED%81%AC-%EB%AC%B8%EC%A0%9C/</guid>
        <description>&lt;img src="https://docs.9bon.org/p/%EB%A6%AC%EB%88%85%EC%8A%A4-%EB%94%94%EC%8A%A4%ED%81%AC-%EB%AC%B8%EC%A0%9C/thum.png" alt="Featured image of post 리눅스 디스크 문제" /&gt;&lt;h2 id=&#34;하드디스크의-문제&#34;&gt;하드디스크의 문제&lt;/h2&gt;
&lt;h3 id=&#34;증상&#34;&gt;증상&lt;/h3&gt;
&lt;p&gt;저장, 삭제시 에러문구 : &amp;ldquo;Structure needs cleaning&amp;rdquo;, &amp;ldquo;구조에 청소가 필요합니다&amp;rdquo;&lt;br&gt;
ls 시 : ??? ?? ???? 로 표시&lt;/p&gt;
&lt;h3 id=&#34;설명&#34;&gt;설명&lt;/h3&gt;
&lt;p&gt;불량, 노후화, 최악에는 소프트웨어의 오류에도 하드디스크에 치명적인 문제가 발생할 수 있습니다.&lt;br&gt;
제가 겪은 문제는 서버가 일종의 과부하를 받을 때 디렉토리 일부가 사라져 조회조차 하지 못하는 상황에&lt;br&gt;
놓이는 것이였습니다.&lt;/p&gt;
&lt;p&gt;놀라서 umount하거나 reboot해서 돌아와보면 디렉토리가 다시 보였지만&lt;br&gt;
디렉토리를 포함한 파일의 일부가 열리지만 소실되었거나, 열리지도 않으며 청소가 필요하다는 경고가 나타났습니다.&lt;br&gt;
흥미로웠던 사실은 비교적 최근에 생성된 것만 그런 상태였습니다. 추정해보면 EXT파일시스템의 특징이&lt;br&gt;
여기서 보이는 것이 아닐까 생각했습니다.&lt;/p&gt;
&lt;p&gt;현재는 과거의 사태에 높은 확률을 따라, 하드디스크의 불량이라고 생각하고 있지만&lt;br&gt;
정확한 원인을 알기는 어려운 상황입니다. 이런일이 발생한다면 어떻게 대처하고 판단해야하는지&lt;br&gt;
작성해 보겠습니다.&lt;/p&gt;
&lt;h2 id=&#34;해결&#34;&gt;해결&lt;/h2&gt;
&lt;h3 id=&#34;fsck&#34;&gt;fsck&lt;/h3&gt;
&lt;p&gt;fsck는 리눅스에서 지원하는 Filesystem fix 명령입니다. 실행하면 체크를 하고, 문제가 생긴 항목을 불러준 뒤&lt;br&gt;
허락하면 교정을 시작합니다. 당연히 un mount 되어있는 상황이여야 합니다.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;umount /dev/&amp;lt;장치명&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;fsck -y /dev/&amp;lt;장치명&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Yes 또는 No로 물어보는 항목이 많고 대부분 오래 걸리므로 -y를 붙여 진행할 수 있습니다.&lt;/p&gt;
&lt;h3 id=&#34;badblocks&#34;&gt;badblocks&lt;/h3&gt;
&lt;p&gt;badblocks는 리눅스에서 기본적으로 하드디스크의 badblock을 점검해주는 명령어 입니다.&lt;br&gt;
어차피 읽기 전용모드로 작동되기 때문에 un mount 되어 있을 필요는 없으나&lt;br&gt;
항상 장치적 문제를 해결할 때는 un mount 하시는 것을 추천드리고 싶습니다.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;umount /dev/&amp;lt;장치명&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;badblocks -v -o out.txt /dev/&amp;lt;장치명&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;-v는 자세하게 보여달라는 뜻이고 -o는 badblock list 를 file output으로 해달라는 뜻입니다.&lt;/p&gt;
&lt;h3 id=&#34;smartctl&#34;&gt;smartctl&lt;/h3&gt;
&lt;p&gt;smartctl은 기본 제공은 아니지만 자주 사용했었던 것입니다.&lt;br&gt;
하드디스크의 모니터링 기술 SMART(Self-Monitoring, Analysis, and Reporting Technology)을 사용하여&lt;br&gt;
점검하는 도구이며 아주 옛날의 하드디스크가 아닌 이상 대부분 장착되어 있습니다.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apt-get install smartmontools
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;umount /dev/&amp;lt;장치명&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;smartctl -a /dev/&amp;lt;장치명&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;자세히는 -a, 간단히는 -H, 정보만은 -i 옵션을 사용하여 진행 가능합니다.&lt;/p&gt;
</description>
        </item>
        
    </channel>
</rss>
